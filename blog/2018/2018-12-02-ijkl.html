---
layout: post
title: магія ijkl
date: '2018-12-02T06:33:00.001+02:00'
author: tivasyk
tags:
- комп'ютери
- клавіатура
- підказки
modified_time: '2018-12-02T06:34:39.817+02:00'
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-3465113452636230885
blogger_orig_url: http://www.tivasyk.info/2018/12/ijkl.html
---

за два роки з компактною клавіатурою я дуже звик рухати курсор комбінацією <i>fn+ijkl</i>. а оскільки <i>fn</i> на pok3r'і можна призначити на <i>capslock</i>, то й для навігації текстом чи веб-сторінкою не доводиться відривати пальці від основного положення…<br /><br />…проблема виникає тоді, коли треба бодай трішки щось зробити на іншій клавіатурі. отже, давня мрія: переналаштувати обробника клавіатури linux так, щоби <i>capslock+ijkl</i> (і кілька інших комбінацій) працювали, як на pok3r'і.<br /><br />щойно подужав… але поки що не впетраю, як це до ладу автоматизувати. поки що просто занотую, як робиться руцями.<br /><br /><h4>capslock</h4>спершу я спробував зробити справу за допомогою <i>xmodmap</i> — вийшло лише частково. але принаймні переналаштування <i>capslock</i> працює:<br /><br /><pre>! ----------------------------------------<br />! CapsLock працюватиме як ISO_Level3_Shift<br />! (третій рівень, зазвичай правий Alt)<br />! ----------------------------------------<br />clear lock<br />clear mod5<br />add mod5 = Caps_Lock ISO_Level3_Shift<br />keycode 66 = ISO_Level3_Shift Caps_Lock</pre><br />це треба зберегти до текстового файлу (приміром, <i>capslock.xmodmap</i>) і завантажити:<br /><br /><code>xmodmap capslock.xmodmap</code><br /><br />після цього <i>capslock</i> дублює функцію правого <i>alt</i>'а (який на моїх обох розкладках, <a href="http://www.tivasyk.info/2013/01/blog-post_22.html">канадській багатомовній</a> та <a href="http://www.tivasyk.info/2010/04/linux-mint.html">українській unicode</a>, дає доступ до «третього шару» — символів на кшалт µ, {} ы тощо), але разом із shift'ом працює як звичайний capslock.<br /><br /><h4>ijkl та латинка</h4>в канадській багатомовній отримати навігацію з <i>altr+ijkl</i> можна так само за допомогою <i>xmodmap</i>. по-перше, можна експортувати поточну розкладку (xmodmap -pke) і підглянути налаштування саме для цих клавіш (grep):<br /><br /><code>xmodmap -pke | grep -e "^.*=\ *[ijkl]" &gt; ijkl.xmodmap</code><br /><br />маю щось таке у файлі <i>ijkl.xmodmap</i>:<br /><br /><pre>keycode&nbsp; 31 = i I Cyrillic_sha Cyrillic_SHA NoSymbol NoSymbol rightarrow idotless<br />keycode&nbsp; 44 = j J Cyrillic_o Cyrillic_O NoSymbol NoSymbol U0133 U0132<br />keycode&nbsp; 45 = k K Cyrillic_el Cyrillic_EL NoSymbol NoSymbol kra NoSymbol NoSymbol NoSymbol Cyrillic_lje Cyrillic_LJE<br />keycode&nbsp; 46 = l L Cyrillic_de Cyrillic_DE NoSymbol NoSymbol U0140 U013F NoSymbol NoSymbol Serbian_dje Serbian_DJE</pre><br />ліворуч (від =) коди клавіш на вході обробника клавіатури xorg. праворуч — те, що обробник подає на вихід, залежно від стану (<i>shift</i>, <i>ctrl</i> тощо). приміром, j та J — це символи (насправді псевдоніми) при нормальному натисканні та з <i>shift</i>'ом. далі — другий рівень (в моєму випадку українська розкладка), нормально та з <i>shift</i>'ом; тут вже добре видно, що це псевдоніми: cyrillic_sha (ш) та cyrillic_SHA (Ш).<br /><br />емпіричним шляхом виявляю, що наступні два псевдоніми (NoSymbol NoSymbol) — це третій рівень першої розкладки, саме те, що вмикає правий alt: так само нормальний ввід та з shift'ом. міняю на псевдоніми потрібних дій:<br /><br /><pre>keycode&nbsp; 31 = i I Cyrillic_sha Cyrillic_SHA <span style="color: #990000;">Up Up</span> rightarrow idotless<br />keycode&nbsp; 44 = j J Cyrillic_o Cyrillic_O <span style="color: #990000;">Left Left</span> U0133 U0132<br />keycode&nbsp; 45 = k K Cyrillic_el Cyrillic_EL <span style="color: #990000;">Down Down</span> kra NoSymbol NoSymbol NoSymbol Cyrillic_lje Cyrillic_LJE<br />keycode&nbsp; 46 = l L Cyrillic_de Cyrillic_DE <span style="color: #990000;">Right Right</span> U0140 U013F NoSymbol NoSymbol Serbian_dje Serbian_DJE</pre><br />згодовую xmodmap'ові й маю бажану навігацію <i>capslock+ijkl</i>, але лише на першій розкладці, канадській:<br /><br /><code>xmodmap ijkl.xmodmap</code><br /><h4>&nbsp;</h4><h4>ijkl та кирилиця</h4>коли я спробував той самий фокус для української розкладки, здогадуючись (див. псевдоніми в рядках keycode 45 та 46), що 11-й та 12-й псевдоніми мають відповідати за третій рівень (altr) другої розкладки — виявилося, що [k] та [l] працюють, а от [i] та [о] — дзуськи. після не дуже результативного гугління поліз глибше — в налаштування xkb, і знайшов.<br /><br />щоби вивантажити налаштування xkb до файлу layout.xkbcomp:<br /><br /><code>xkbcomp $DISPLAY layout.xkbcomp</code><br /><br />по-перше, аліаси потрібних клавіш (коди 31, 44, 45 та 46):<br /><br /><pre>&lt;AD08&gt; = 31;<br />...<br />&lt;AC07&gt; = 44;<br />&lt;AC08&gt; = 45;<br />&lt;AC09&gt; = 46;</pre><br />тут A — основна частина клавіатури, D та C — ряди (знизу вгору), 07 — номер клавіші. далі шукаю налаштування для кожної клавіші. ось моя <i>j</i>:<br /><br /><pre>key &lt;AD08&gt; {<br />&nbsp; type[group1]= "EIGHT_LEVEL_SEMIALPHABETIC",<br />&nbsp; <span style="color: #660000;">type[group2]= "ALPHABETIC",</span><br />&nbsp; symbols[Group1]= [ i, I, Up, Up, rightarrow,&nbsp; idotless, NoSymbol, NoSymbol ],<br />&nbsp; <span style="color: #660000;">symbols[Group2]= [&nbsp; Cyrillic_sha, Cyrillic_SHA ]</span></pre><br />порівнюючи це з одним рядком виводу xmodmap для клавіші [i] (код 31), здогадуюсь: це мої розкладки (<i>type[groupX]</i>) і відповідний набір псевдонімів (<i>symbols[groupX]</i>). українська для j відформатована за шаблоном "alphabetic", котрий містить (це видно вище у файлі) лише два символи: нормальний та з shift'ом (оті <i>cyrillic_sha</i> та <i>cyrillic_SHA</i>). ось шаблон:<br /><br /><pre>type "ALPHABETIC" {<br />&nbsp; modifiers= Shift+Lock;<br />&nbsp; map[Shift]= Level2;<br />&nbsp; map[Lock]= Level2;<br /><span style="color: #660000;">&nbsp; level_name[Level1]= "Base";<br />&nbsp; level_name[Level2]= "Caps";</span><br />};</pre><br />так само [j] має лише два символи в українській розкладці. натомість, клавіші [k] та [l] в українській розкладці відформатовано за іншим шаблоном, в якому визначено чотири символи (і після спроби редагування xmodmap'ом тут вже є потрібні псевдоніми down):<br /><br /><pre>key <ac08> {<br />  type[group1]= "EIGHT_LEVEL_SEMIALPHABETIC",<br />  <span style="color: #660000;">type[group2]= "FOUR_LEVEL_ALPHABETIC",</span><br />  symbols[Group1]= [ k, K, Down, Down, kra, NoSymbol, NoSymbol, NoSymbol ],<br />  <span style="color: #660000;">symbols[Group2]= [ Cyrillic_el, Cyrillic_EL, </span></ac08><span style="color: #660000;"><ac08>Down, </ac08><ac08>Down ]</ac08></span></pre><br />шаблон «four_level_alphabetic»:<br /><br /><pre>type "FOUR_LEVEL_ALPHABETIC" {<br />  modifiers= Shift+Lock+LevelThree;<br />  map[Shift]= Level2;<br />  map[Lock]= Level2;<br />  map[LevelThree]= Level3;<br />  map[Shift+LevelThree]= Level4;<br />  map[Lock+LevelThree]= Level4;<br />  map[Shift+Lock+LevelThree]= Level3;<br /><span style="color: #660000;">  level_name[Level1]= "Base";<br />  level_name[Level2]= "Shift";<br />  level_name[Level3]= "Alt Base";<br />  level_name[Level4]= "Shift Alt";</span><br />};</pre><br />отже, щоби навігація працювала і в українській розкладці, треба «поремонтувати» налаштування клавіш [i] (AD08) та [j] (AC07) — замінити шаблон і додати по два псердоніми:<br /><br /><pre>key &lt;AD08&gt; {<br />  type[group1]= "EIGHT_LEVEL_SEMIALPHABETIC",<br />  type[group2]= "FOUR_LEVEL_ALPHABETIC",<br />  symbols[Group1]= [ i, I, Up, Up, rightarrow, idotless, NoSymbol, NoSymbol ],<br />  symbols[Group2]= [ Cyrillic_sha, Cyrillic_SHA, Up, Up ]<br />};</pre><pre>...</pre><pre>key &lt;AC07&gt; {<br />  type[group1]= "EIGHT_LEVEL_SEMIALPHABETIC",<br />  type[group2]= "FOUR_LEVEL_ALPHABETIC",<br />  symbols[Group1]= [ j, J, Left, Left, U0133, U0132, NoSymbol, NoSymbol ],<br />  symbols[Group2]= [ Cyrillic_o, Cyrillic_O, Left, Left ]<br />}; </pre><br />після цього завантажую налаштування:<br /><br /><code>xkbcomp layout.xkbcomp $DISPLAY</code><br /><br />і навігація <i>capslock+ijkl </i>працює з обома розкладками.<br /><h4>&nbsp;</h4><h4>проблеми</h4>на жаль, налаштування працюють до перезавантаження, перелогінення, ба навіть перепідключення зовнішньої клавіатури. можливе вирішення — <br /><ul><li>модифіковані розкладки вже з потрібними налаштуваннями (але доведеться щоразу після поновлення системи їх відновлювати, мабуть);</li><li>або ж якийсь скрипт для вивантаження налаштувань <i>xkbcomp</i>, автоматичного редагування і зворотнього завантаження.</li></ul>окрім того, треба додати <i>home</i>, <i>end</i>, <i>pgdn</i>, <i>pgup</i> та <i>insert,</i> як це зроблено на pok3r'і. але принаймні це вже зрозуміло як зробити.