---
layout: post
title: 'linux і модем: спілкування в терміналі…'
date: '2010-08-25T17:17:00.127+03:00'
author: tivasyk
tags:
- інтернет
- комп'ютери
- linux
- підказки
modified_time: '2010-08-26T20:57:45.106+03:00'
thumbnail: http://4.bp.blogspot.com/_wFmUV6FUCKU/SqkGbL_oUAI/AAAAAAAAF-A/Zhy-iby0Dvs/s72-c/zte_mf100_kyivstar_01.JPG
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-8850742881234333381
blogger_orig_url: http://www.tivasyk.info/2010/08/linux.html
---

<a href="http://4.bp.blogspot.com/_wFmUV6FUCKU/SqkGbL_oUAI/AAAAAAAAF-A/Zhy-iby0Dvs/s1600-h/zte_mf100_kyivstar_01.JPG" onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}"><img alt="" border="0" id="BLOGGER_PHOTO_ID_5379838294016675842" src="http://4.bp.blogspot.com/_wFmUV6FUCKU/SqkGbL_oUAI/AAAAAAAAF-A/Zhy-iby0Dvs/s200/zte_mf100_kyivstar_01.JPG" style="cursor: pointer; float: right; height: 117px; margin: 0pt 0pt 10px 10px; width: 200px;" /></a>дуже давно не згадував про ту пару 3g-модемів, що колись <a href="http://www.tivasyk.info/2009/09/blog-post_5913.html">придбав собі з пакетами київстару</a>. головною тому причиною були неадекватні київстарівські тарифи на інтернет. тож вже розлочені (<a href="http://3g.novostavskiy.kiev.ua/2009/10/zte-mf-100.html">дякую юрі новоставському</a>) модеми лежали собі на поличці, аж поки один я не віддав братові, а другий… другий вирішив таки використати — але цього разу вже <a href="http://utel.ua/ua/private/tariffs.php?show=payment_packet">з передплаченим сервісом від utel’а</a>, точніше <a href="http://utel.ua/ua/about/news.php?id=150">тепер вже від укртелекому</a>.<br /><br />з підключенням розлоченого модема до linux’а не все пішло гладко, тож треба розбиратися… але&nbsp;про особливості підключення розповім за іншим разом, а наразі&nbsp;так-сяк інтернет вже працює — цей допис саме публікую, підключившись через модем. допис про інше.<br /><br />раніше я стрічався із задачкою змусити модем підключатися лише до 3g-мережі utel, ігноруючи<i> gprs/edge</i> в київстарівському (дорогому) роумінгу… і вирішував її (точніше, думав, що вирішував) <a href="http://www.tivasyk.info/2009/09/3g_25.html">за допомогою пк з windows і «рідного» київстарівського софта</a>. справа не в теоретично вищій швидкості, а в контрольованості витрат. цього разу вирішив таки знайти спосіб зробити це прямо в linux’і… і дізнався багато нового.<br /><br /><a name='more'></a><b>по-перше</b>, виявляється (сюрприз!), що модем zte mf100 не пам’ятає налаштування режиму вибору мережі… тобто якщо я раз в рідній програмі наказав йому «чіпляти» тільки 3g-мережу — це налаштування зберігається не модемом, а цією програмою, і при підключенні до іншого комп’ютера модем повернеться до режиму «<i>wcdma/edge/gprs</i> з пріоритетом найсильнішого сигналу» — а найкращий сигнал у нас навіть в києві переважно саме в <i>gprs/edge</i>. (<b>поновлення</b>: насправді можна змусити модем запам’ятати налаштування).<br /><br /><b>по-друге</b>, <a href="http://www.tivasyk.info/2009/09/3g-linux-mint.html">складну операцію з відключення функції zerocd</a> через видалення пари файлів на модемі, після якої модем починає нормально розпізнаватися в linux’і, тепер можна не виконувати — і, більше того, <b>не треба</b> цього робити! бо сучасні дистрибутиви вже мають в наборі <a href="http://beta.enetri.com/2010/04/21/3.html">софтинку usb_modeswitch</a> і вміють автоматично переключати режим роботи такого «свистка»… а якщо навіть не вміють — той же ефект можна отримати <a href="http://ubuntuforums.org/showthread.php?t=1359410">однією простою at-командою</a> для модема, і за необхідності повернути все «як було» іншою простою командою.<br /><br /><b>по-третє</b>, купу інших операцій з модемом, включаючи встановлення режиму вибору мережі, сканування доступних мереж, отримання службової інформації (<i>imei</i>, номер <i>sim</i>-карти, рівень сигналу тощо) та відсилку <i>ussd</i>-кодів (для перевірки балансу тощо) — також <a href="http://m-blog.pp.ua/%D0%B1%D0%B5%D0%B7-%D1%80%D1%83%D0%B1%D1%80%D0%B8%D0%BA%D0%B8/14.html">можна здійснювати за допомогою at-команд</a>.<br /><br />і нарешті — <b>найцікавіше</b>. власне, увесь допис заради цієї невеличкої нотатки собі на пам’ять: як надсилати команди модему і (головне) отримати від нього якусь реакцію? в деталях це за посиланням вище не описано.<br /><br />запихаємо модем до роз’єма usb, трішки чекаємо, і перевіряємо, чи система його побачила і впізнала. по-перше, команда lsusb має в одному з рядків дати щось таке:<br /><blockquote>Bus 001 Device 004: ID <b>19d2:0016</b> ONDA Communication S.p.A.</blockquote>ідентифікатори 19d2:0016 згадувалися <a href="http://www.tivasyk.info/2009/09/3g-linux-mint.html">в моїх попередніх дописах про mf100</a>. &nbsp;команда&nbsp;<i>dmesg | tail -n 50 | grep "GSM modem"</i> має показати кілька рядків, серед яких будуть такі:<br /><blockquote>option 1-1:1.0: GSM modem (1-port) converter detected<br />usb 1-1: GSM modem (1-port) converter now attached to ttyUSB0<br />option 1-1:1.1: GSM modem (1-port) converter detected<br />usb 1-1: GSM modem (1-port) converter now attached to ttyUSB1<br />option 1-1:1.2: GSM modem (1-port) converter detected<br />usb 1-1: GSM modem (1-port) converter now attached to <b>ttyUSB2</b></blockquote>це означає, що система віддала модему три віртуальних порти. лише останній, ttyusb2 використовується для звичайного зв’язку з модемом.<br /><br /><a href="http://2.bp.blogspot.com/_wFmUV6FUCKU/THUuJ7Gjx2I/AAAAAAAAI7A/KdiWMYJW0SY/s1600/linux_modem_term_01.png_resize.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="116" src="http://2.bp.blogspot.com/_wFmUV6FUCKU/THUuJ7Gjx2I/AAAAAAAAI7A/KdiWMYJW0SY/s200/linux_modem_term_01.png_resize.jpg" width="200" /></a>далі починається проста вулична магія. відкриваємо два термінали. в одному будемо спостерігати реакцію модема на команди — але спершу треба в ньому дати команду (див. скріншот, лівий термінал):<br /><blockquote>$ sudo cat /dev/ttyUSB2</blockquote>…і надати системі пароль адміністратора. з’єднання з інтернетом не має бути встановлене — інакше порт виявиться зайнятий. в другому терміналі можна починати забавлятися. наприклад:<br /><blockquote>$ echo -e "AT+COPS=?\r\n" &gt; /dev/ttyUSB2</blockquote>у відповідь на цю команду модем (подумавши довгенько) видасть в перший термінал (див. скріншот) перелік доступних мереж. інші команди можна <a href="http://m-blog.pp.ua/%D0%B1%D0%B5%D0%B7-%D1%80%D1%83%D0%B1%D1%80%D0%B8%D0%BA%D0%B8/14.html">підглянути в оригінальному дописі</a>, на який я вже посилався.<br /><br /><b>важливо!</b> щоби продовжити роботу з модемом — підключитися за допомогою <i>wvdial </i>тощо — треба «сказати»<i> ctrl+c</i> в першому терміналі… інакше<i> wvdial </i>не «бачитиме» реакції модема на свої at-команди.<br /><br />наразі все. детальніше про роботу з модемчиком, швидкість та якість зв’язку і таке інше розповім пізніше, коли ще пограюся.<br /><br /><b>поновлення.</b> ще кілька цікавих команд <a href="http://www.gsm-modem.de/gsm-modem-faq.html">перераховано тут</a>. схоже, що є спосіб змусити модем запам’ятати режим вибору мережі — командою at&amp;w… але не пробував ще.