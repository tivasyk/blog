---
layout: post
title: 'linux і дресирований модем: режим, баланс, вибір мережі'
date: '2010-09-03T17:46:00.005+03:00'
author: tivasyk
tags:
- інтернет
- комп'ютери
- linux
- підказки
modified_time: '2010-11-17T11:27:19.334+02:00'
thumbnail: http://lh4.ggpht.com/_wFmUV6FUCKU/TIENGriwCCI/AAAAAAAAI98/Jcomw5MWyHE/s72-c/zte_mf100_utel_01.jpg
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-2457888383940837706
blogger_orig_url: http://www.tivasyk.info/2010/09/linux.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://lh4.ggpht.com/_wFmUV6FUCKU/TIENGriwCCI/AAAAAAAAI98/Jcomw5MWyHE/s1600/zte_mf100_utel_01.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="133" src="http://lh4.ggpht.com/_wFmUV6FUCKU/TIENGriwCCI/AAAAAAAAI98/Jcomw5MWyHE/s200/zte_mf100_utel_01.jpg" width="200" /></a></div>продовжую користуватися <a href="http://www.tivasyk.info/2010/08/3g.html">3g-модемом і передплаченим інтернетом від utel/укртелеком</a> на нетбуці з linux — <a href="http://www.tivasyk.info/2010/08/blog-post_31.html">тепер з #!crunchbang</a>. як і раніше, <i>network manager</i> чомусь не хоче працювати з модемом — але <i>wvdial</i> дозволяє підключатися без зайвих проблем (якщо не гидувати набором однієї команди в терміналі).<br /><br />минулого разу я звітував про те, як можна надсилати модему різні at-команди — цікава вправа, але надто багато мороки з двома терміналами для такої дрібнички. є кращий спосіб — скористатися perl-скриптом, що його написав і <a href="http://m-blog.pp.ua/">виклав у вільний доступ</a> якийсь <strike>безіменний герой</strike> михайло бурштинський. скрипт «вміє» показувати стан модема (код imei, серійний номер, версія прошивки тощо), керувати режимом роботи (вибір оператора та типу мережі) та посилати ussd-запити (баланс чи поповнення рахунку), звітуючи про результат.<br /><br /><a name='more'></a><b>ліричний відступ</b>: ось для таких задач, як на мене, і треба використовувати інтерпретовані мови програмування на кшалт python’а, perl’а, ruby тощо… — разові чи періодичні суто утилитарні функції. ну ще макетування програм на ранньому етапі розробки… для серйозніших проектів — компільовані мови, класичні c/c++. бо ж розвели зоопарк: як не кинешся шукати нормальний jabber-клієнт, torrent-витягувалку чи текстовий редактор — а всюди самі лише python’и.<br /><br />втім, <b>повернуся до теми</b>. все, що треба — завантажити архів зі скриптом (файл mf100.pl.tar.gz), розархівувати власне скрипт (файл mf100.pl), закинути в теку /usr/bin, прибрати розширення .pl (це опціонально, для простоти) і дати права на виконання. на всяк випадок — відповідні команди:<br /><blockquote><code>cd ~<br />wget -c http://m-blog.pp.ua/files/mf100.pl.tar.gz<br />gzip -d mf100.pl.tar.gz<br />tar -xf mf100.pl.tar<br />sudo mv mf100.pl /usr/bin/mf100<br />sudo chmod +x /usr/bin/mf100</code></blockquote><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_wFmUV6FUCKU/TIEFnZGivKI/AAAAAAAAI90/2zrgWFsnYWA/s1600/linux_modem_term_02.png_resize.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="116" src="http://3.bp.blogspot.com/_wFmUV6FUCKU/TIEFnZGivKI/AAAAAAAAI90/2zrgWFsnYWA/s200/linux_modem_term_02.png_resize.jpg" width="200" /></a></div>готово. далі все просто: підключаємо модем zte mf100 (для нього писалося — але ймовірно, що працюватиме з якимись іншими подібними моделями), трішки чекаємо, поки на нім загориться зелений індикатор, і пробуємо в терміналі:<br /><blockquote><code>mf100 info</code></blockquote>у відповідь скрипт повинен сказати приблизно таке:<br /><blockquote><code>Производитель: xxxxx<br />Модель: xxxxx<br />Версия ПО: BD_UAKVSP671A1V1.0.0B01<br />IMEI: xxxxxxxxxxxxxxx<br />IEMS:&nbsp;xxxxxxxxxxxxxxx<br />Ваш номер: +38091xxxxxxx<br />Уровень сигнала сети: 48%<br />Оператор: Utel "UMTS"<br />Режим поиска сети: автоматически, только WCDMA</code></blockquote>якщо запустити mf100 без параметрів — скрипт розкаже, які команди можна використовувати. приміром, для того, щоб вибрати режим роботи (gprs/edge чи wcdma, ручний вибір чи автоматичний), командуємо:<br /><blockquote><code>mf100 search</code></blockquote>…і вибрати один із запропонованих варіантів (в моєму випадку 5 — автоматичний вибір лише wcdma-мереж). перевірити баланс можна так:<br /><blockquote><code>mf100 *100# (sim-карта utel/укртелеком)<br />mf100 *111# (sim-карта київстар)</code></blockquote>ще одна невеличка підказка. найшвидший, мабуть, спосіб перевірити, чи розпізнався модем у linux’і — «поштрикати» його конфігуратором wvdial:<br /><blockquote><code>sudo wvdialconf</code></blockquote><b>увага!</b> ця команда замінить вміст файлу <i>/etc/wvdial.conf</i> на стандартний шаблон з вказанням порта, на якому знайдено модем, і мінімальної протестованої швидкості (як правило 9600) — тому файл обов’язково треба відредагувати, перш ніж пробувати підключатися. ось мій варіант для zte mf100 та utel/укртелеком:<br /><blockquote><code>[Dialer Defaults]<br />Modem = /dev/ttyUSB2<br />Modem Type = USB Modem<br />Init1 = ATZ<br />Init2 = ATQ0 V1 E1 S0=0 &amp;C1 &amp;D2 +FCLASS=0<br />Init3 = AT+CGDCONT=1, "IP", "3g.utel.ua"<br />Phone = *99#<br />ISDN = 0<br />Stupid Mode = 1<br />Username = ''<br />Password = ''<br />Ask Password = 0<br />Baud = 460800<br />New PPPD = yes</code></blockquote>все, успіхів!