---
layout: post
title: twitter-стрічка на стільниці (перший варіант)
date: '2011-10-21T18:45:00.000+03:00'
author: tivasyk
tags:
- комп'ютери
- linux
- підказки
- bash
modified_time: '2016-03-24T10:31:34.133+02:00'
thumbnail: https://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s72-c/deep_ascii_screenshot.png
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-2043221566396221089
blogger_orig_url: http://www.tivasyk.info/2011/10/twitter.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://www1.zkm.de/%7Ewvdc/ascii/java/" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="133" src="https://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s200/deep_ascii_screenshot.png" width="200" /></a></div><a href="http://www.tivasyk.info/2011/10/sed-sedulous-sedition.html">подужав!</a> після того, як трішки освоївся із <i>sed</i>’ом та <i>bash</i>’ем — пішло як по маслу, ще й <b>інтерес прокинувся по-справжньому</b>. щоправда, результат ще не фінальний — тепер мені не подобається компоновка елементів на екрані, — хочеться зібрати інший конфіг <i>conky</i>, і переписати скрипт читання стрічки так, щоби скористатися форматуванням. тим не менш, вже юзабельно.<br /><br />поточний результат <a href="http://1.bp.blogspot.com/-M-xftTw2k3w/TqGRXxHEt6I/AAAAAAAAL3M/_a5R44ALmxw/s1600/screenshot_linux_conky_twitter.jpg">на скріншоті</a> під катом.<br /><br />власне скрипт, котрий завантажує <i>twitter</i>-стрічку (точніше архів власних твітів, тому що після відписування від усіх стрічка пуста) і форматує для виводу в conky, виглядає так:<br /><br /><a name='more'></a><blockquote><code><span style="color: #351c75;">#! /bin/bash</span><br style="color: #351c75;" /><span style="color: #351c75;"> # Script: </span><br style="color: #351c75;" /><span style="color: #351c75;"> #&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; twitter_read</span><br style="color: #351c75;" /><span style="color: #351c75;"> # Read twitter archive via twidge into a file .twitter_archive</span><br /><br /><span style="color: #351c75;"># files created and checked for by the script:</span><br />work_dir=~/conky/<br />file_dump=${work_dir}.twitter_dump<br />file_archive=${work_dir}.twitter_archive<br /><br /><span style="color: #351c75;"># create an empty .twitter_archive if it doesn't exist yet</span><br />if [ ! -e ${file_archive} ]; then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; touch ${file_archive}<br />fi<br /><br /><span style="color: #351c75;"># try downloading last 20 own messages from twitter archive</span><br />twidge lsarchive -l &gt; ${file_dump}<br /><br />if [ "$?" -eq "0" ]; then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: #351c75;"># twidge connected ok!</span><br style="color: #351c75;" /><span style="color: #351c75;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # filter the twidge dump into short format with sed</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cat $file_dump | sed -e 's/^[^\t]*\t//' -e 's/\t\t/› /' -e 's/\t.*$//' -e 's/ \+/ /g' -e 's/$/ /g;s/http:[^ ]*[ ]/[↗] /g;s/ \+$//' -e 's/^/♀/;s/$/♂/;s/♀*\( *.\{1,40\}\)[ ♂]/\1\n/g' -e 's/[[:space:]]$//' &gt; $file_archive<br />fi<br /><br />exit 0</code></blockquote><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-M-xftTw2k3w/TqGRXxHEt6I/AAAAAAAAL3M/_a5R44ALmxw/s1600/screenshot_linux_conky_twitter.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="111" src="https://1.bp.blogspot.com/-M-xftTw2k3w/TqGRXxHEt6I/AAAAAAAAL3M/_a5R44ALmxw/s200/screenshot_linux_conky_twitter.jpg" width="200" /></a></div>з тексту очевидно, що результат роботи скрипта — відформатована стрічка з рядками не довше 40 символів, — збережена в файлі <i>~/conky/.twitter_archive</i>. сам скрипт <i>twitter_read.sh </i>зручно тримати в тійже теці.<br /><br />запустити скрипт і вивести стрічку на стільницю (точніше, лише перші 30 рядків, на жаль) можна таким рядком в конфігу <i>conky</i>: <br /><blockquote><code>${texeci 60 ~/conky/twitter_read.sh}${head ~/conky/.twitter_archive 30 10}</code></blockquote>перша команда (<i>texeci</i>) запускає скрипт <b>окремим тредом</b> один раз на 60 секунд, друга (<i>head</i>) — виводить перші 30 рядків текстового файлу один раз на кожні 10 поновлень conky (<a href="http://conky.sourceforge.net/variables.html">детальніше</a>).<br /><br />наразі все, але продовження буде обов’язково.<br /><br /><b>оновлено.</b> один (головний!) рядок скрипта було неповністю скопійовано в текст — виправив, тепер все гаразд.