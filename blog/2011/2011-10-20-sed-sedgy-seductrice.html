---
layout: post
title: sed — a sedgy seductrice
date: '2011-10-20T02:06:00.002+03:00'
author: tivasyk
tags:
- комп'ютери
- linux
- підказки
modified_time: '2011-10-20T14:07:38.581+03:00'
thumbnail: http://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s72-c/deep_ascii_screenshot.png
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-9001229912106504559
blogger_orig_url: http://www.tivasyk.info/2011/10/sed-sedgy-seductrice.html
---

<div style="text-align: right;"><i>от же ж бісів sed! гризу його, <br />гризу — а воно ж огризається =/</i><br /><a href="http://twitter.com/#%21/tivasyk/status/126406168645074944">twitter</a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://www1.zkm.de/%7Ewvdc/ascii/java/" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="133" src="http://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s200/deep_ascii_screenshot.png" width="200" /></a></div>учора <b>не виспався</b>: пізно вклався, а ще вікно залишив закритим (комунальники чудово підготувалися до холодів: не включили опалення, ще й гарячу воду відключили, бо щось десь поламали); над ранок голова була важка, як сніп.<br /><br />а вкладався пізно, бо пригадував <a href="http://www.tivasyk.info/2010/09/sed.html">(не)просту текстову магію</a>. хотів накидати робочу версію скрипта <a href="http://www.tivasyk.info/2011/10/blog-post_11.html">для виводу twitter-стрічки на стільницю</a> — але спершу треба зрозуміти, як за допомогою <i>sed</i>’а відформатувати текст. отже…<br /><br />по-перше, <i>twidge</i> (консольний <a href="http://www.tivasyk.info/2010/03/twitter-brizzly.html">twitter-клієнт для linux</a>) забезпечує завантаження останніх 20 твітів зі стрічки:<br /><blockquote><code>twidge lsarchive -l</code></blockquote><br /><a name='more'></a>ключик -l видає «довгий» формат — п’ять полів, розділених табуляцією (тут третє пусте):<br /><blockquote><code>126549795966955521&nbsp;&nbsp;&nbsp; tivasyk&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; визначення sedust в urban dictionary порвало на шмаття =) http://t.co/EBC28yF7&nbsp;&nbsp;&nbsp; Wed Oct 19 06:46:37 +0000 2011<br />126406168645074944&nbsp;&nbsp;&nbsp; tivasyk&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; от же ж бісів sed! гризу його, гризу — а воно ж огризається =/&nbsp;&nbsp;&nbsp; Tue Oct 18 21:15:53 +0000 2011</code></blockquote>далі <i>sed</i>, порціонально. ось так <b>прибираю ідентифікатор</b> на початку рядка разом із наступним символом табуляції:<br /><blockquote><code>sed -e 's/^[^\t]*\t//'</code></blockquote>залишившши <i>tivasyk</i>, видаляю <b>дві табуляції поспіль</b> (щоправда, тут припускаю, що більше такі пари ніде не повторюються, що, в принципі, не гарантовано… але наразі працює) і додаю розділювач:<br /><blockquote><code>sed -e 's/\t\t/› /'</code></blockquote>видаляю увесь останній <b>блок з датою/часом</b> публікації (знову-таки, з припущенням, що він таки останній):<br /><blockquote><code>sed -e 's/\t.*$//'</code></blockquote>про всяк випадок скорочую <b>дубльовані пробіли</b>, якщо знайдуться:<br /><blockquote><code>sed -e 's/ \+/ /g'</code></blockquote>нарешті <b>заміняю гіперпосилання</b> (навіщо вони у виводі <i>conky</i> на стільниці, де їх не можна клікнути?) позначкою [↗]; попередньо додаю пробіл в кінець рядка (щоби правильно впізнати посилання між http:// і найближчим пробілом), а по завершенні видаляю його, якщо виявився непотрібним:<br /><blockquote><code>sed -e 's/$/ /g;s/http:[^ ]*[ ]/[↗] /g;s/ $//'</code></blockquote>лишається <b>об’єднати всі команди</b> в один рядок:<br /><blockquote><code>twidge lsarchive -l | sed -e 's/^[^\t]*\t//' -e 's/\t\t/› /' -e 's/\t.*$//' -e 's/ \+/ /g' -e 's/$/ /g;s/http:[^ ]*[ ]/[↗] /g;s/ $//'</code></blockquote>…і отримати на виводі таке:<br /><blockquote><code>tivasyk› визначення sedust в urban dictionary порвало на шмаття =) [↗]<br />tivasyk› от же ж бісів sed! гризу його, гризу — а воно ж огризається =/</code></blockquote>втім, ще не все — хочеться <b>розбити тепер довгі рядки</b> на фрагменти не більше 50 символів. з цим проблема: не второпаю дібрати правильний набір команд для sed’а. хто дружить із цією <i>sedgy seductrice</i> — <b>підкажіть варіант?</b><br /><br /><b>оновлення. </b>здається, <a href="http://www.tivasyk.info/2011/10/sed-sedulous-sedition.html">впорався: читайте, як</a>.<br /><br /><b>p.s.</b> так, я знаю, <a href="http://www.ljudmila.org/%7Evuk/ascii/deep.htm">звідки скріншот</a>. поставив свідомо — по-перше, пасує до заголовка (вміст) і тексту (форма); по-друге, великоднє яєчко назло <a href="http://www.tivasyk.info/2011/10/blog-post_19.html">нацкомісії з моралі</a>.<br />