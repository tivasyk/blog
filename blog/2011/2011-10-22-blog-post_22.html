---
layout: post
title: розірвати нерозривне!
date: '2011-10-22T02:14:00.002+03:00'
author: tivasyk
tags:
- комп'ютери
- linux
- підказки
modified_time: '2011-10-22T02:14:56.735+03:00'
thumbnail: http://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s72-c/deep_ascii_screenshot.png
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-3579349027957489160
blogger_orig_url: http://www.tivasyk.info/2011/10/blog-post_22.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://www1.zkm.de/%7Ewvdc/ascii/java/" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="133" src="http://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s200/deep_ascii_screenshot.png" width="200" /></a></div>здається, я таки навчився трішки користуватися sed’ом: з першого разу накидав команду, котра примусово <b>вставляє розриви в надто довгі текстові рядки</b> без пробілів, ігноруючи водночас текст з пробілами:<br /><blockquote><code>sed -e 's/\([^ ]\{39\}\)\([^ ]\)/\1 \2/g'</code></blockquote>працює так: шукає нерозривний блок з 39-ти будь-яких символів окрім пробілу, за яким йде ще один не-пробіл (<span style="color: #351c75;">\([^ ]\)</span>)— і всталяє один пробіл перед цим останнім не-пробілом (<span style="color: #351c75;">\1 \2</span>). <i>g</i> змушує повторювати операцію до кінця рядка.<br /><br />отже, тепер можна <b>позбутися головного недоліку</b> <a href="http://www.tivasyk.info/2011/10/sed-sedulous-sedition.html">попередньої версії sed-фільтра для форматування twitter-стрічки</a> — і будь-якого іншого текстового потоку — для виводу на стільницю!<br /><br /><a name='more'></a>вся команда:<br /><blockquote><code>sed -e 's/^[^\t]*\t//;s/\t\t/› /;s/\t.*$//' -e 's/ \+/  /g' </code><code>-e 's/$/ /g;s/http:[^ ]*[ ]/[↗] /g;s/ $//'</code><code> -e 's/\([^ ]\{40\}\)\([^ ]\)/\1 \2/g' -e  's/^/♀/;s/$/♂/;s/♀*\( *.\{1,40\}\)[ ♂]/\1\n/g' -e 's/[[:space:]]$//'</code><code></code></blockquote>перекомпонував трішки різні блоки. тепер <b>послідовність операцій</b> (кожен блок зі своїм <i>-e</i>) така: <br /><ul><li>у виводі <i>twidge</i> залишаємо лише відправника і текст;</li><li>якщо є кілька пробілів поспіль — скорочуємо до одного;</li><li>заміняємо гіперпосилання простим [↗];</li><li>якщо в тексті є нерозривні фрагменти, довші 40 символів — примусово розбиваємо пробілом;</li><li>розбиваємо текст на окремі рядки не довше 40 символів;</li><li>видаляємо зайвий символ переносу рядка наприкінці.</li></ul>готово. очевидно, що для підготовки для виводу в <i>conky</i> довільного текстового файлу варто прибрати перший блок (який парсить специфічно вивід twidge), додавши блок для видалення пустих рядків і підчистки символів cr (на випадок текстів, згенерованих у dos/windows):<br /><blockquote><code>sed -e '/^[[:space:]]*$/d' -e 's/ \+/ /g;s/\x0D$//' -e 's/$/ /g;s/http:[^ ]*[ ]/[↗] /g;s/ $//' -e 's/\([^ ]\{40\}\)\([^ ]\)/\1 \2/g' -e 's/^/♀/;s/$/♂/;s/♀*\( *.\{1,40\}\)[ ♂]/\1\n/g' -e 's/[[:space:]]$//'</code></blockquote>ну й наостанок скріншот, який показує, <b>що ж я хочу отримати на стільниці </b>після всього. скріншот «живий» — це те, що вже працює.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-tBUDSYSXE4w/TqH8d_XnGlI/AAAAAAAAL3k/0FZomXveU3U/s1600/linux_twitter_notes_conky.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="223" src="http://3.bp.blogspot.com/-tBUDSYSXE4w/TqH8d_XnGlI/AAAAAAAAL3k/0FZomXveU3U/s400/linux_twitter_notes_conky.jpg" width="400" /></a></div><br />продовження буде!