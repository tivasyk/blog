---
layout: post
title: sed — a sedulous sedition
date: '2011-10-20T14:04:00.001+03:00'
author: tivasyk
tags:
- комп'ютери
- linux
- підказки
modified_time: '2011-10-21T18:49:04.041+03:00'
thumbnail: http://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s72-c/deep_ascii_screenshot.png
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-111810137637630234
blogger_orig_url: http://www.tivasyk.info/2011/10/sed-sedulous-sedition.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://www1.zkm.de/%7Ewvdc/ascii/java/" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="133" src="http://1.bp.blogspot.com/-HuCwFUa2hKM/Tp8-9xZKzhI/AAAAAAAAL28/EPX8Sq2cpH8/s200/deep_ascii_screenshot.png" width="200" /></a></div>свідомо не шукав знавців на форумах, бо хтів спершу самотужки дійти хоча б якогось, хай не дуже вдалого варіанту рішення… і, здається, подужав — <a href="http://www.tivasyk.info/2011/10/sed-sedgy-seductrice.html">змусив sed розбивати довгі рядки</a> на фрагменти по 1–50 символів.<br /><br />малював схеми, «курив мани», читав попередні дописи про sed — врешті-решт зконструював для цього таку команду:<br /><blockquote><code>sed -e 's/^/♀/;s/$/♂/;s/♀*\( *.\{1,49\}\)[ ♂]/\1\n/g;s/[[:space:]]$//'</code></blockquote>не ідеально, але про недоліки пізніше. спершу деконструюю собі на згадку. тут чотири блоки, розділені крапко-комами.<br /><br /><a name='more'></a>двома першими блоками додаю якісь рідко вживані <b>символи для позначення</b> початку та кінця рядка (♀ та ♂ відповідно):<br /><blockquote><code>sed -e 's/^/♀/;s/$/♂/;</code></blockquote>наступний блок <b>вибирає з тексту фрагмент довжиною 1–49 символів</b> (<span style="color: blue;">.*\{1,49\}</span>) плюс попередній пробіл, якщо він є (<span style="color: blue;"> *</span>), так, щоби зліва, <i>можливо</i>, був мій спецсимвол початку рядка (<span style="color: blue;">♀*</span>), а справа <i>обов’язково</i> пробіл <i>або</i> спецсимвол кінця рядка (<span style="color: blue;">[ ♂]</span>), — і заміняє цей фрагмент (<span style="color: blue;">\(…\)</span>) ним же (<span style="color: blue;">\1</span>) плюс спецсимвол наступного рядка (<span style="color: blue;">\n</span>); повторити операцію, поки ще залишився необроблений текст (<span style="color: blue;">g</span>):<br /><blockquote><code>s/♀*\( *.\{1,49\}\)[ ♂]/\1\n/g;</code></blockquote>ну й останній блок виправляє невеликий побічний ефект — <b>видаляє зайвий символ \n</b>, що опиняється наприкінці після такого перебору:<br /><blockquote><code>s/[[:space:]]$//'</code></blockquote>результат застосування до двох рядків з попереднього допису:<br /><blockquote><code>tivasyk›&nbsp;визначення&nbsp;sedust&nbsp;в&nbsp;urban&nbsp;dictionary<br />порвало&nbsp;на&nbsp;шмаття&nbsp;=)&nbsp;[↗]<br />tivasyk›&nbsp;от&nbsp;же&nbsp;ж&nbsp;бісів&nbsp;sed!&nbsp;гризу&nbsp;його,&nbsp;гризу&nbsp;—&nbsp;а<br />воно&nbsp;ж&nbsp;огризається&nbsp;=/</code></blockquote>отримав те, що потрібно. варіант, втім, далеко не ідеальний. <b>очевидний недолік </b>— не впорається з довгими рядками без пробілів. звісно, такі трапляються нечасто — але якщо трапиться, <i>conky</i> просто виведе такі рядки як є, «поламавши» форматування виводу: погано. тож доведеться ще думати, як це врахувати, але як для першої версії — годиться.<br /><br />що далі? якщо всю конструкцію (<i>twidge</i> + <i>sed</i>) втулити в конфіг conky — воно працюватиме. <b>допоки не зникне зв’язок з інтернетом</b> або через якусь іншу помилку twidge не зможе завантажити стрічку — і тоді видасть непоказне повідомлення про помилку. не дуже гарно.<br /><br />потрібен <i>bash</i>-скрипт, котрий не просто завантажуватиме і форматуватиме стрічку для виводу в <i>conky</i>, але й відловлюватиме помилки і в такому випадку видаватиме акуратне повідомлення плюс спеціально збережений у локальному файлі <b>архів стрічки</b>.<br /><br />заготовка є — але детально <a href="http://www.tivasyk.info/2011/10/twitter.html">будео кремим дописом</a>.