---
layout: post
title: шарік, ти балбєс!
date: '2011-06-21T14:17:00.000+03:00'
author: tivasyk
tags:
- комп'ютери
- linux
- підказки
modified_time: '2011-06-21T14:17:01.390+03:00'
thumbnail: http://1.bp.blogspot.com/-gJdIY4A0C08/Tf7x7MsvnWI/AAAAAAAAK_c/Bcm0ss1Ak6E/s72-c/sony_psp.jpg
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-2891469085872595366
blogger_orig_url: http://www.tivasyk.info/2011/06/blog-post_21.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-gJdIY4A0C08/Tf7x7MsvnWI/AAAAAAAAK_c/Bcm0ss1Ak6E/s1600/sony_psp.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="138" src="http://1.bp.blogspot.com/-gJdIY4A0C08/Tf7x7MsvnWI/AAAAAAAAK_c/Bcm0ss1Ak6E/s200/sony_psp.jpg" width="200" /></a></div>продовжуючи тему <b>конвертування відео для sony psp</b>, мушу почати з класичного <i>«шарік, ти балбєс!»</i> — адресуючи це собі. бо <a href="http://www.tivasyk.info/2011/06/sony.html">теж заслужив</a>: забув, що краще не знати й не братися, аніж <a href="http://www.phrases.org.uk/meanings/a-little-knowledge-is-a-dangerous-thing.html">знати трішки</a> і бути самовпевненим (<i>a little learning is a dangerous thing</i>).<br /><br />втім, наполегливість (варта, мабуть, кращого застосування) — чи впертість? — змусили таки знайти рішення… котре лежало, як частенько буває, <a href="http://blog.yogarine.com/2007/12/converting-video-for-psp-on-linux.html">готове в тенетах</a>. виявляється, кодек <i>h.264/mpeg-4</i> потребує додаткового налаштування, щоби видати сумісний з psp відеопотік, і, окрім того, <i>avidemux</i> навіть має спеціальний профіль для експорту на psp в три кліки мишкою.<br /><br />результат — таки конвертував мультфільм. далі <b>два рецепти</b>: простий і правильний.<br /><br /><a name='more'></a><h2>рецепт простий: автоматичний режим</h2><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-xtMQmZLfjEE/Tf_JpSf2laI/AAAAAAAAK_w/ZVAaM011wIU/s1600/linux_avidemux_psp_07_auto.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="142" src="http://1.bp.blogspot.com/-xtMQmZLfjEE/Tf_JpSf2laI/AAAAAAAAK_w/ZVAaM011wIU/s200/linux_avidemux_psp_07_auto.jpg" width="200" /></a></div>найпростіший варіант. меню <i>auto</i> &gt; <i>sony playstation portable</i> в <i>avidemux</i> версій 2.2 та старше. програма запропонує вибрати розмір кадра (рідне — 480×272 пікс.) та співвідношення сторін джерела та вихідного файла (краще лишити як є, 1:1).<br /><br />власне, це все. можна експортувати відео, чекати закінчення конвертування, заливати на картку пам’яті — і дивитися на psp.<br /><br /><b>проте</b> автоматичний режим нецікавий: за іншим разом, не маючи під рукою <i>avidemux</i>’а  чи іншої софтинки з готовим профілем конвертування для psp, знову  вперся би в ту ж проблему. більше того, скрипт-чарівник не може ідеально налаштувати весь процес конвертування: зокрема, лише зменшує кадр до обраної рамки (480×272), додаючи чорних смуг до повного кадру, ігнорує інші фільтри (кадрування? насиченість? чіткість?), сильно жертвує швидкістю на користь якості тощо.<br /><br />коротше кажучи, з точки зору вимогливого користувача, — це лажа. тим часом магії ж ніякої немає, все лише  питання <a href="http://blog.yogarine.com/2007/12/converting-video-for-psp-on-linux.html">точного налаштування кодека</a>. врешті-решт, мені просто цікаво було з цим розібратися.<br /><br /><h2>рецепт правильний: ручками, ручками</h2><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-YcteGHwje0c/TgA9noiCQKI/AAAAAAAALAI/OYfLTMVuIag/s1600/linux_avidemux_psp_01.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="111" src="http://4.bp.blogspot.com/-YcteGHwje0c/TgA9noiCQKI/AAAAAAAALAI/OYfLTMVuIag/s200/linux_avidemux_psp_01.jpg" width="200" /></a></div>коротко — є ряд специфічних параметрів кодека <i>h.264/mpeg-4</i>, котрі мають бути встановлені так, а не інак, аби примхлива сонєвська залізяга розпізнала відеопотік в контейнері. вони перелічені <a href="http://blog.yogarine.com/2007/12/converting-video-for-psp-on-linux.html">в дописі датського техноблогера yogarine</a>, на який я вже посилався (англ.) — далі детальніше зі скріншотами.<br /><br /><b>контейнер</b> (формат файлу) — <i>mp4</i>. можна вибрати <i>mp4 (psp)</i> в avidemux’і, проте перевіривши два файли на psp 3000, я не помітив різниці — обидва програються нормально, розмір однаковий. можливо, це було важливо для попередніх версій psp? голосую за «універсальний» mp4.<br /><br /><b>аудіокодек</b> — <i>mpeg-4 aac</i>, називається просто <i>aac </i>в avidemux’і. як на мене, бітрейт вище 128 кбіт/с позбавлений сенсу у випадку конвертації для перегляду на psp.<br /><br /><b>відеокодек</b> — <i>h.264/mpeg-4</i>, називається <i>mpeg-4 avc</i> в avidemux’і, кодування реалізоване за допомогою <a href="http://en.wikipedia.org/wiki/X.264">відкритої бібліотеки x264</a>. в стандартні налаштуваннях кодека avidemux треба внести такі специфічні для psp поправки (див.скріншоти далі):<br /><ul><li>встановити значення <i>2</i> для параметра <i>max. ref. frames</i> (в розділі <i>motion estimation</i>, вкладка <i>motion &amp; misc</i>);</li><li>виключити параметр <i>8×8 transform</i> (в розділі <i>partition macroblocks</i>, вкладка <i>partitions &amp; frames</i>);</li><li>виключити параметр <i>use as reference</i> (в розділі <i>b-frames</i>, та сама вкладка);</li></ul><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-fU7Z9IGS67g/TgA9oa8KVlI/AAAAAAAALAQ/q-2wZG9c_l0/s1600/linux_avidemux_psp_03_setup.png" imageanchor="1" style="margin-left: 5px; margin-right: 5px;"><img border="0" height="200" src="http://2.bp.blogspot.com/-fU7Z9IGS67g/TgA9oa8KVlI/AAAAAAAALAQ/q-2wZG9c_l0/s200/linux_avidemux_psp_03_setup.png" width="163" /></a><a href="http://4.bp.blogspot.com/-ct7TcAD2kZc/TgA9m0wExgI/AAAAAAAALAE/QEzFwpUTAoM/s1600/linux_avidemux_psp_04_setup.png" imageanchor="1" style="margin-left: 5px; margin-right: 5px;"><img border="0" height="200" src="http://4.bp.blogspot.com/-ct7TcAD2kZc/TgA9m0wExgI/AAAAAAAALAE/QEzFwpUTAoM/s200/linux_avidemux_psp_04_setup.png" width="163" /></a></div><br />решту параметрів лишаю як є — можна «курити мануали» й експерементувати, намагаючись досягти максимального виграшу в співвідношенні якості відео, розміру файлу та швидкості кодування, але це для завзятих.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-X1L_SDr1wiw/TgA9lzAaKiI/AAAAAAAALAA/yaPEaCB357s/s1600/linux_avidemux_psp_02_setup.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="200" src="http://1.bp.blogspot.com/-X1L_SDr1wiw/TgA9lzAaKiI/AAAAAAAALAA/yaPEaCB357s/s200/linux_avidemux_psp_02_setup.png" width="163" /></a></div><b>режим кодування, бітрейт, квантизатор якості</b> — ці параметри (вкупі з масштабуванням кадру) найсильніше впливають на швидкість кодування та якість відео. варто вибирати свідомо.<br /><br />якщо важлива якість (якесь хороше кіно для багаторазового перегляду?) — варто залишити ті параметри, що пропонує профіль psp в avidemux: двопрохідне кодування з дотриманням середнього бітрейту в районі 1000 кбіт/с (<i>two-pass</i>, <i>average bitrate</i>, <i>1000 kbit/s</i>), — і приготуватися чекати 4-8 годин на середньостатистичному ноутбуці.<br /><br />мені потрібен файл для разового перегляду в дорозі — жертвую якістю, вибравши однопрохідне кодування з квантизатором близько 25 (<i>single-pass</i>, <i>quality quantizer</i>, <i>25</i>). виший квантизарор (від 0 до 50) — гірша якість.<br /><br />далі — налаштування фільтрів.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-NESI-DquhGE/TgA9xbYipPI/AAAAAAAALAY/19n6pdiD5BE/s1600/linux_avidemux_psp_08_filters.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="111" src="http://2.bp.blogspot.com/-NESI-DquhGE/TgA9xbYipPI/AAAAAAAALAY/19n6pdiD5BE/s200/linux_avidemux_psp_08_filters.jpg" width="200" /></a></div><b>масштабування і кадрування</b>.розмір кадру відео для psp, якщо вірити знавцям, обмежений кількома фіксованими варіантами, аж до 720×480. сам не перевіряв, чи справді все так погано. раджу масштабувати та кадрувати до рідних 480×272 пікселів: від більшої картинки на маленькому дисплеї не буде виграшу в якості, а менша хоч і дасть «легший файл», проте виглядатиме вже помітно гірше.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-57Q4lBM_E6Q/TgA9zAPEpGI/AAAAAAAALAc/6KlB2wbKSTo/s1600/linux_avidemux_psp_09_filters.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="111" src="http://4.bp.blogspot.com/-57Q4lBM_E6Q/TgA9zAPEpGI/AAAAAAAALAc/6KlB2wbKSTo/s200/linux_avidemux_psp_09_filters.jpg" width="200" /></a></div>найкращий підхід: фільтром <i>mplayer resize</i> відмасштабувати кадр <b>до 480×272 по меншій стороні</b> (відносно 16:9), тобто якщо кадр ширший 16:9 — масштабуємо так, щоби по висоті вмістився в 272 пікселі, якщо «квадратний» — щоби вмістився по ширині в 480 пікселів (див. <a href="http://2.bp.blogspot.com/-NESI-DquhGE/TgA9xbYipPI/AAAAAAAALAY/19n6pdiD5BE/s1600/linux_avidemux_psp_08_filters.jpg">скріншот</a>). наступним фільтром <i>crop</i> обрізаємо зайве по вертикалі або горизонталі двома однаковими смужками (див. <a href="http://4.bp.blogspot.com/-57Q4lBM_E6Q/TgA9zAPEpGI/AAAAAAAALAc/6KlB2wbKSTo/s1600/linux_avidemux_psp_09_filters.jpg">скріншот</a>).<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-1Swe7D3adhE/TgA9z_dxdbI/AAAAAAAALAg/nBB53IZTSPg/s1600/linux_avidemux_psp_10_filters.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="111" src="http://3.bp.blogspot.com/-1Swe7D3adhE/TgA9z_dxdbI/AAAAAAAALAg/nBB53IZTSPg/s200/linux_avidemux_psp_10_filters.jpg" width="200" /></a></div><b>контрастність, насиченість, чіткість</b>. для вихідних файлів з хорошою якістю цей етап зайвий, але старі (й не дуже) мальовані мультфільми сильно виграють від «викручування» цих параметрів, особливо коли йдеться про перегляд на малих дисплеях. найбільше сподобалася комбінація з двох фільтрів: <i>mplayer eq2</i> (збільшити контрастність, насиченість, гаму, див. <a href="http://3.bp.blogspot.com/-1Swe7D3adhE/TgA9z_dxdbI/AAAAAAAALAg/nBB53IZTSPg/s1600/linux_avidemux_psp_10_filters.jpg">скріншот</a>) та <i>msharpen</i> (чіткість), — з параметрами треба трішки експериментувати, орієнтуючись на прев’юшку.<br /><br />готово, — тепер можна запускати конвертування і чекати.<br /><br /><b>p.s.</b> до речі, avidemux є і <a href="http://avidemux.berlios.de/download.html">для windows</a>, в т.ч. <a href="http://avidemux-portable.en.softonic.com/">портативний</a>. і ще: <a href="http://www.tivasyk.info/search/?q=%D0%B2%D1%96%D0%B4%D0%B5%D0%BE%D0%BF%D1%96%D0%B4%D0%BA%D0%B0%D0%B7%D0%BA%D0%B0">відеопідказка</a> за мотивами допису комусь цікава?