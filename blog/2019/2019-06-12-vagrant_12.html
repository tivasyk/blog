---
layout: post
title: 'знижка на vagrant’и: дві коробки за ціною однієї'
date: '2019-06-12T17:54:00.003+03:00'
author: tivasyk
tags:
- комп'ютери
- windows
- linux
- vagrant
modified_time: '2019-06-12T17:54:45.684+03:00'
thumbnail: https://1.bp.blogspot.com/-elqtLKSdER0/XQEM-16C1aI/AAAAAAABXxc/auJXj3AgIekd0VlAnirWDO39-dMpo1FFACLcBGAs/s72-c/screenshot.2019-06-12_lomo.jpg
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-9171568712365636607
blogger_orig_url: http://www.tivasyk.info/2019/06/vagrant_12.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-elqtLKSdER0/XQEM-16C1aI/AAAAAAABXxc/auJXj3AgIekd0VlAnirWDO39-dMpo1FFACLcBGAs/s1600/screenshot.2019-06-12_lomo.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" data-original-height="968" data-original-width="1600" height="193" src="https://1.bp.blogspot.com/-elqtLKSdER0/XQEM-16C1aI/AAAAAAABXxc/auJXj3AgIekd0VlAnirWDO39-dMpo1FFACLcBGAs/s320/screenshot.2019-06-12_lomo.jpg" width="320" /></a></div>продовжую <a href="http://www.tivasyk.info/2019/06/vagrant.html" target="_blank">вивчати vagrant</a> методом «наукового тику» (насправді <a href="https://uk.wikipedia.org/wiki/%D0%9C%D0%B5%D1%82%D0%BE%D0%B4_%D0%BF%D1%80%D0%BE%D0%B1_%D1%96_%D0%BF%D0%BE%D0%BC%D0%B8%D0%BB%D0%BE%D0%BA" target="_blank">ні</a>): запропонований в підготовчому розділі «ansible up and running» варіант запускати одну тестову машину мені не підійшов — ansible не працює на windows (це не зовсім правда, але…), тож мені потрібно дві тестових віртуалки: одна як сервер, на другій ansible. як це зробити з vagrant?<br /><br /><h4>multi-machine</h4>виявляється, все <a href="https://www.vagrantup.com/docs/multi-machine/" target="_blank">передбачено</a>. додаємо преконфігурацію <a href="https://www.vagrantup.com/docs/networking/private_network.html" target="_blank">приватної мережі</a> зі статичними адресами та <a href="https://www.vagrantup.com/intro/getting-started/networking.html" target="_blank">переадресування портів</a> — і маємо Vagrantfile (див. далі), який піднімає дві «коробки»:<br /><ul><li>server (192.168.8.1, порт 22 &lt;- 8122 на хості)</li><li>ansible (192.168.8.2, порт 22 &lt;- 8222 на хості)</li></ul>до кожної можна за-ssh-тися двома способами (з теки з Vagrantfile’ом):<br /><div><code><br />vagrant ssh &lt;назва&gt;</code></div><br />або<br /><div><code><br />ssh vargant@127.0.0.1 -p 8x22 -i .\.vagrant\machines\&lt;назва&gt;\virtualbox\private_key</code></div><br /><a name='more'></a><h4>інфраструктура як код</h4>тут <i>x</i> — 1 або 2, а &lt;назва&gt; — <i>server</i> або <i>ansible</i>, див. Vagrantfile:<br /><code></code><br /><pre><code>Vagrant.configure("2") do |config|<br />  config.vm.define "server" do |<span style="color: #990000;"><b>server</b></span>|<br />    server.vm.box = "debian/stretch64"<br />    server.vm.network "private_network", ip: "192.168.8.1"<br />    server.vm.network :forwarded_port, guest: 22, host: 8122<br />    server.vm.provision :shell, inline: "Machine «server» is up..."<br />  end<br /><br />  config.vm.define "ansible" do |<span style="color: #990000;"><b>ansible</b></span>|<br />    ansible.vm.box = "debian/stretch64"<br />    ansible.vm.network "private_network", ip: "192.168.8.2"<br />    ansible.vm.network :forwarded_port, guest: 22, host: 8222<br />    ansible.vm.provision :shell, inline: "Machine «ansible» is up..."<br />  end<br />end</code></pre><br /><h4>трохи чітерства і питання</h4>імена машин (hostname) я міняв руками на ті ж таки server та ansible вже через ssh:<br /><br /><code>(sudo) hostnamectl set-hostname &lt;назва&gt;</code><br /><br />але як це зробити vagrant'ом на етапі створення машини? мої тестові рядки <i>provision</i>, здається, не працюють як слід — не впетраю, чому. хтось підкаже?