---
layout: post
title: вдосконалений скрипт quaketerm
date: '2016-03-26T22:57:00.002+02:00'
author: tivasyk
tags:
- комп'ютери
- linux
- bash
modified_time: '2016-04-01T21:31:58.931+03:00'
thumbnail: https://4.bp.blogspot.com/-MZZsYedrGhs/VvbyzEIZcbI/AAAAAAAAvjw/fX-b7eTj8O4lBb5P9cqiI6bPzTRDN9C5A/s72-c/2016-03-26--1459019987_1366x768_scrot_logo.jpg
blogger_id: tag:blogger.com,1999:blog-1498862426470895405.post-149538657567182190
blogger_orig_url: http://www.tivasyk.info/2016/03/quaketerm_26.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-MZZsYedrGhs/VvbyzEIZcbI/AAAAAAAAvjw/fX-b7eTj8O4lBb5P9cqiI6bPzTRDN9C5A/s1600/2016-03-26--1459019987_1366x768_scrot_logo.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="111" src="https://4.bp.blogspot.com/-MZZsYedrGhs/VvbyzEIZcbI/AAAAAAAAvjw/fX-b7eTj8O4lBb5P9cqiI6bPzTRDN9C5A/s200/2016-03-26--1459019987_1366x768_scrot_logo.jpg" width="200" /></a></div>мав трохи часу та натхнення вдосконалити той простий <a href="http://www.tivasyk.info/2016/03/quaketerm-brocket.html" target="_blank">скрипт для квейкізації терміналу</a>:<br /><ul><li>розміри терміналу тепер у % від стільниці з автоматичним центруванням;</li><li>скрипт автоматично визначає розміри стільниці;</li><li>значно акуратніший код. </li></ul>на жаль, поки що не подужав виправити головний недолік: ховаючись, термінал не віддає фокус іншому вікну — поки що не знаю, як це зробити.<br /><br />як ще можна вдосконалити? може, додати можливість вибрати емулятор терміналу, а якщо вибраний не встановлено — запускати заданий в $term?<br /><br />кому треба — скрипт під катом.<br /><br /><b>поновлення</b> (2016-03-27). поборов проблему з фокусом за допомогою xdotool, під катом оновлений код.<br /><br /><b>поновлення</b> (2016-03-28). ні, не поборов: запускаю нову версію через alt+f2 (gmrun) — працює, але «вішаю» на хоткей openbox — не працює =/<br /><br /><a name='more'></a><code><br />#!/bin/bash<br /># ------------------------------------------------------------------------------<br /># quaketerm v0.3<br /># e script to lauch a single instance of a terminal (terminator) in a quake mode<br /># (drop-down): attach to a hotkey (win+q for exampple) and hit the combination<br /># to launch/hide/unhide the terminal<br /># acknowledgement: this script was initially based off a much simpler one found<br /># at https://www.linuxjournal.com/magazine/hack-and-automate-your-desktop-wmctrl<br /># dependencies: wmctrl, cut, xdotool<br /># known issue: upon hiding the terminal does not loose focus (this really needs<br /># fixing...)<br /># ------------------------------------------------------------------------------<br /># changelog:<br /># v0.3<br />#   xdotool to fix focus issue (pass focus to previous running app)<br /># v0.2<br />#   setting terminal size in %, autocentering, code cleanup<br /># v0.1<br />#   first working version, terminal title, code cleanup<br /># ------------------------------------------------------------------------------<br /><br />main () {<br />  # SET these variables to setup the desired quake-like terminal dimentions<br />  local TERMINAL_WIDTH_REL=80   # in %<br />  local TERMINAL_HEIGHT_REL=70 # in %<br />  local TERMINAL_X=-1           # if set to -1 will center automatically<br />  local TERMINAL_Y=0            # default is 0 (top of screen); set to -1 to center vertically<br />  local TERMINAL_TITLE="Quaketerminal"<br /><br />  # do not edit these variables: defined internally<br />  local DESKTOP_SIZE="0x0"<br />  local DESKTOP_WIDTH=0    # in px<br />  local DESKTOP_HEIGHT=0  # in px<br />  local TERMINAL_WIDTH=0    # in px<br />  local TERMINAL_HEIGHT=0   # in px<br />  readonly TAB=$(echo -e "\t")<br /><br />  # out of the regular desctops list provided by wmctl -d cut out one line<br />  # for the active desktop and then cut out the desktop size (in WxH format)<br />  DESKTOP_SIZE=$(wmctrl -d | grep " \* " | cut -d " " -f 5 )<br /><br />  # divide the desktop size string into x and y<br />  DESKTOP_WIDTH=$(echo "$DESKTOP_SIZE" | cut -d "x" -f 1 )<br />  DESKTOP_HEIGHT=$(echo "$DESKTOP_SIZE" | cut -d "x" -f 2 )<br /><br />  # do some checks on the settings<br />  if [[ ${TERMINAL_WIDTH_REL} -gt 100 ]]; then<br />    $TERMINAL_WIDTH_REL=100<br />  fi<br />  if [[ ${TERMINAL_HEIGHT_REL} -gt 100 ]]; then<br />    $TERMINAL_HEIGHT_REL=100<br />  fi<br />  if [[ ${TERMINAL_X} -gt ${DESKTOP_WIDTH} ]]; then<br />    $TERMINAL_X=-1<br />  fi<br />  if [[ ${TERMINAL_Y} -gt ${DESKTOP_HEIGHT} ]]; then<br />    $TERMINAL_Y=0<br />  fi<br /><br />  # calculate absolute terminal width x height based on relative size in %<br />  # and the desktop size (gives integer result in bash (no float math)<br />  TERMINAL_WIDTH=$(( ${DESKTOP_WIDTH}*${TERMINAL_WIDTH_REL}/100 ))<br />  TERMINAL_HEIGHT=$(( ${DESKTOP_HEIGHT}*${TERMINAL_HEIGHT_REL}/100 ))<br />  <br />  # calculate position (x of the left top corner) for the terminal window<br />  # (the y coordinate should be set by user, usually just 0)<br />  if [[ ${TERMINAL_X} -lt 0 ]]; then<br />    TERMINAL_X=$(( (${DESKTOP_WIDTH}-${TERMINAL_WIDTH})/2 ))<br />  fi<br />  if [[ ${TERMINAL_Y} -lt 0 ]]; then<br />    TERMINAL_Y=$(( (${DESKTOP_HEIGHT}-${TERMINAL_HEIGHT})/2 ))<br />  fi<br /><br />  # check if the terminal window with the set title exists already<br />  # and if not -- launch the terminal with the set title and geometry<br />  wmctrl -l | grep "${TERMINAL_TITLE}"<br />  if [[ $? -ne 0 ]]; then<br />    terminator --title="${TERMINAL_TITLE}" --geometry="${TERMINAL_WIDTH}"x"${TERMINAL_HEIGHT}"+"${TERMINAL_X}"+"${TERMINAL_Y}" &amp;<br />  fi<br />  <br />  # now the terminal window should be running<br />  # unshade and bring to the front if shaded<br />  if [[ -f $HOME/.quaketerm.shaded ]]; then<br />    wmctrl -F -R "${TERMINAL_TITLE}"<br />    wmctrl -F -r "${TERMINAL_TITLE}" -b remove,below,shaded<br />    rm $HOME/.quaketerm.shaded<br />  # shade and send back if active and simulate Alt+Tab keypress <br />  # to pass focus to next app (case is important, "alt+tab" will trigger error)<br />  else<br />    wmctrl -F -r "${TERMINAL_TITLE}" -b add,shaded,below<br />    touch $HOME/.quaketerm.shaded<br />    xdotool key alt+Tab<br />  fi<br />}<br /><br /># main program loop<br />main<br /><br />exit 0<br /></code>